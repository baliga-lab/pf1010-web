{% extends "base.html" %}
{% block title %}Edit System{% endblock %}
{% block content %}
<div>
  <form id="edit_form">
    <input type="hidden" name="uid" value="{{system_data['UID']}}"></input>
    <h2>Edit System</h2>
    <div class="form-group">
      <label>System Name</label>
      <input type="text" class="form-control" name="name" placeholder="System Name" value="{{system_data['name']}}" required>
    </div>

    <div class="form-group">
      <div class="col-xs-8">
        <label>Crop</label>
      </div>
      {% for c in system_data['crops'] %}<div id="cropsrow_{{loop.index - 1}}"></div>{% endfor %}
    </div>
    <div id="newcrop"></div>
    <div style="height: 2.5em"><a id="addcrop" href="javascript:void(0)">Add another crop</a></div>

    <div class="form-group">
      <div class="col-xs-8">
        <label>Aquatic Organism</label>
      </div>
      {% for o in system_data['organisms'] %}<div id="orgrow_{{loop.index - 1}}"></div>{% endfor %}
    </div>
    <div id="neworganism"></div>
    <div style="height: 2.5em"><a id="addorganism" href="javascript:void(0)">Add another aquatic organism</a></div>

    <div class="form-group">
      <button type="submit" class="btn btn-green">Save Changes</button>
    </div>
  </form>
</div>
{% endblock %}
{% block scripts %}
    {{ super() }}
    <script type="text/javascript" src="{{ url_for('frontend.static', filename='js/edit_system.js') }}"></script>
    <script>
      var crops = [
        {% for crop in enums['crops'] %}{ "id": {{ crop.ID }}, "name": "{{ crop.name }}" },{% endfor %}
      ];
      var organisms = [
        {% for o in enums['organisms'] %}{ "id": {{ o.ID }}, "name": "{{ o.name }}" },{% endfor %}
      ];
      $(document).ready(function () {
        /*
        if (!Modernizr.inputtypes.date) {
          $('#start-date').datepicker({dateFormat: "yy-MM-dd"});
        }
      */
      {% for c in system_data['crops'] %}
      aqx_editsystem.makeInputRow('cropsrow_{{loop.index - 1}}', 'crop', {{loop.index - 1}},
                                  crops, "Number of Crops", {{c.id}}, {{c.count}});
      {% endfor %}

      {% for o in system_data['organisms'] %}
      aqx_editsystem.makeInputRow('orgrow_{{loop.index - 1}}', 'organism', {{loop.index - 1}},
                                  organisms, "Number of Organisms", {{o.id}}, {{o.count}});
      {% endfor %}

        $('#edit_form').submit(function () { aqx_editsystem.update("{{url_for('frontend.update_system', system_uid=system_data['UID'])}}"); });
      });
    </script>
{% endblock %}
