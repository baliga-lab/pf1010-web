{% extends "base.html" %}

{% block title %}Groups{% endblock %}

{% block styles %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('social.static', filename='css/group_social.css') }}">
{% endblock %}

{% block content %}

    <!-- Div for Groups Pane - Container Div -->
    <div class="container groupDiv">

        <!-- Div for Left Pane (Group Description, Participant, Manage Requests) - Groups Page -->
        <div class="col-md-3 leftPaneDiv">
            <div class="row systemDescription">
                <h4 class="systemName">  {{ group_neo4j[0][0]['name'] }} </h4>
                <h5 class="systemCreated" id="systemCreatedTime"><b>Created On: </b>
                    {{ creation_date }}
                </h5>
                <h5 class="systemDescription"><b> Description: </b> {{ group_neo4j[0][0]['description'] }}</h5>
            </div>


            <br>
            <form id="join_leave_group"
                  action="{{ url_for('social.join_leave_group') }}" method="post">
                <div class="row sendRequests">
                    <input type="hidden" name="google_id"
                           value="{{ logged_in_user["google_id"] }}">
                    <input type="hidden" name="group_uid"
                           value="{{ group_neo4j[0][0]["group_uid"] }}">
                    <input type="hidden" name="is_private_group"
                           value="{{ group_neo4j[0][0]["is_private_group"] }}">

                    {% if not user_privilege %}
                        <button class="btn btn-primary" name="submit" value="Join" role="button">Join</button>
                    {% elif user_privilege=="GROUP_MEMBER" or user_privilege=="GROUP_ADMIN" %}
                        <button class="btn btn-danger" name="submit" value="Leave" role="button"
                                onclick="return getUserConsent()">Leave
                        </button>

                    {% elif user_privilege=="GROUP_PENDING_MEMBER" %}
                        <button class="btn btn-danger" name="submit" role="button" value="Leave"
                                onclick="return getUserConsent()">Cancel Request
                        </button>
                    {% endif %}
                </div>
            </form>
            <!-- Div for Managing Member Requests (Approve/Reject) Button. Manage System Settings Too -->
            {% if user_privilege == "GROUP_ADMIN" %}

                <div class="row pendingRequestsTitleDiv">
                    <h4>Member Request ({{ members_pending_approval | length }})</h4>
                </div>

                <div class="row pendingRequests">
                    <!-- Iterate Over Pending Approval Members -->
                    {% if members_pending_approval %}
                        {% for pending_member in members_pending_approval %}
                            <form action="{{ url_for('social.approve_reject_group_member') }}" method="post">
                                <div class="pendingRequestElements">
                                    <input type="hidden" name="google_id"
                                           value="{{ pending_member[0]["google_id"] }}">
                                    <input type="hidden" name="group_uid"
                                           value="{{ group_neo4j[0][0]["group_uid"] }}">
                                    <a href="{{ url_for('social.profile', google_id=pending_member[0]["google_id"]) }}">
                                        <img class="pendingMemberImage img-circle"
                                             src="{{ pending_member[0]["image_url"] }}">
                                        {% if pending_member[0]["displayName"] is not none %}
                                            {{ pending_member[0]["displayName"] }}
                                        {% else %}
                                            {{ "No Display Name" }}
                                        {% endif %}
                                    </a>
                                    <button type="submit" name="submit" value="Approve" class="btn btn-success">
                                        Approve
                                    </button>
                                    <button type="submit" name="submit" value="Reject" class="btn btn-danger">
                                        Reject
                                    </button>
                                </div>
                            </form>
                        {% endfor %}
                        <!-- There exists No Pending Approval Members -->
                    {% else %}
                        <span>
                                <h5>Currently, there are no pending Members for the system</h5>
                            </span>
                    {% endif %}
                </div>

                <!-- Div for Manage Settings/Adding Admin(s) To The Group -->
                <div class="row">
                    <span>
                        <a href="{{ url_for('social.manage_group', group_uid= group_neo4j[0][0]["group_uid"]) }}">
                            <img class="cogWheelIcon"
                                 src="{{ url_for('social.static', filename='images/system_settings.png') }}">
                            Manage Group
                        </a>
                    </span>
                </div>
                <!-- End Of Div for Manage Settings/Adding Admin(s) To The Group -->

            {% endif %}
            <!-- End of Div for Managing Member Requests (Approve/Reject) Button. Manage Group Settings Too -->

            <br/>

            <div>
                <h3>Group members</h3>
                {% if group_members %}

                    {% for row in group_members %}
                        {% if loop.index < stop_at %}

                            <li>

                              <img src="{{row[0]['image_url']}}" width="25" height="25">  <a href="{{ url_for('social.profile',google_id=row[0]['google_id']) }}">{{ row[0]['displayName'] }}</a>
                            </li>
                        {% endif %}
                    {% endfor %}
                {% endif %}
                <br>
                <button type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#myMembersModal">See
                    all
                    Members
                </button>
                <br><br>
            </div>
        </div>
        <!-- End Div for Left Pane (Group Description, Participant, Manage Requests) - Groups Page -->


        <!-- This rightPaneDiv for Group posts - Group Page -->
        <div class="col-md-9 rightPaneDiv">

            <p>
                "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
                dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip
                ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
                fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia
                deserunt mollit anim id est laborum."
            </p>

        </div>
        <!-- End of rightPaneDiv (Group Posts) - Group Page -->


    </div>
    <!-- End of Div for Groups Pane - Container Div -->


    <div id="myMembersModal" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Group members</h4>
                </div>
                <div class="modal-body">
                    <h3>Group members</h3>
                    {% if group_members %}

                        {% for row in group_members %}
                            <li>
                               <img src="{{row[0]['image_url']}}" width="25" height="25">    <a href="{{ url_for('social.profile',google_id=row[0]['google_id']) }}">{{ row[0]['displayName'] }}</a>
                            </li>

                        {% endfor %}
                    {% endif %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
                <!-- Modal -->
            </div>
        </div>
    </div>


{% endblock %}


{% block scripts %}
    {{ super() }}
    <!-- jQuery Script For DOM Manipulation In Groups Page -->
    <script type="text/javascript" src="{{ url_for('social.static', filename='js/group_social.js') }}"></script>
{% endblock %}