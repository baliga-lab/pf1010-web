{% extends "base.html" %}

{% block title %}Groups{% endblock %}

{% block styles %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('social.static', filename='css/groups.css') }}">
    <link href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.6.3/css/bootstrap-select.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
{% endblock %}

{% block content %}

    <!-- Entire Page Div Container -->
    <div class="container" id="searchGroupsTab">
        <span>
            <img class="groupIcon" src="{{ url_for('social.static', filename='images/groups.png') }}">
            <h3 class="page-header">&nbsp; Groups</h3>
        </span>
        <ul class="nav nav-tabs" id="tab-headers">
            <li><a href="#createGroupTab">Create Group</a></li>
            <li><a href="#myGroupsTab">My Groups</a></li>
            <li><a href="#searchGroupsTab">Search Groups</a></li>
            <li><a href="#recommendedGroupsTab">Recommended Groups</a></li>
        </ul>
        <br>

        <!-- Create Groups Div -->
        <div class="container" id="createGroupTab">
        <form action="{{ url_for('social.create_group') }}" method="post"> 
          <div class="form-group">
                      <label for="txtGroupName">Name:</label> 
                    <input type="text"
                           class="form-control"
                           name="name"
                           id="txtGroupName"  
                           pattern=".{1,}"
                           required 
                           title="Group Name Cannot Be Empty"
                           placeholder="Group Name" > </input>
                </div>
                 
                <div class="form-group">
                      <label for="txtGroupDescription">Description:</label> 
                    <input type="text"
                           class="form-control"
                           name="description"
                           id="txtGroupDescription"  
                           pattern=".{1,}"
                           required 
                           title="Group Description Cannot Be Empty"
                           placeholder="Group Description"> </input>
                </div>
                 
                <div class="form-group"> 
                    <b>Private Group: &nbsp;</b> 
                    <label class="radio-inline"> 
                        <input type="radio"
                               name="is_private_group"
                               id="rbYes"
                               value="true"
                               />
                        Yes 
                    </label> 
                    <label class="radio-inline"> 
                        <input type="radio"
                               name="is_private_group"
                               id="rbNo"
                               value="false"  
                               />
                        No 
                    </label> 
                </div>
                <button type="submit" class="btn btn-primary form-control" value="Save">Create</button>
          </form>
        </div>
        <!-- End of Create Groups Div -->

        <!-- My Groups Div -->
        <div class="row" id="myGroupsTab">
            <div class="col-md-6">
                <p><b>Admin Groups:</b></p>
                <br>
                {% if admin_groups %}
                        {% for row in admin_groups %}
                            <div class="row">
                                <ul>
                                    <a href="{{ url_for('social.view_group', group_uid=row.group.group_uid) }}"><i class="fa fa-users fa-2x"></i>&nbsp;{{ row.group.name }}</a>
                                </ul>
                                <br>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="row">
                            <ul>
                                <i class="fa fa-frown-o fa-3x"></i>&nbsp;You are yet to become admin for any group.
                            </ul>
                        </div>
                    {% endif %}
            </div>
            <div class="col-md-6">
                <p><b>Member Groups:</b></p>
                <br>
                {% if member_groups %}
                        {% for row in member_groups %}
                            <div class="row">
                                <ul>
                                    <a href="{{ url_for('social.view_group', group_uid=row.group.group_uid) }}"><i class="fa fa-university fa-2x"></i>&nbsp;{{ row.group.name }}</a>
                                </ul>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="row">
                            <ul>
                                <i class="fa fa-frown-o fa-3x"></i>&nbsp;You are yet to become member for any group
                            </ul>
                        </div>
                    {% endif %}

            </div>
        </div>
        <!-- End of My Groups Div -->


        <!-- Search Groups Div -->
        <div class="container" id="searchGroupsTab">
            <div class="input-group col-md-12">
                <input type="text" id="autocomplete" class="form-control input-lg" placeholder="Search groups"/>
            </div>
        </div>
        <!-- End of Search Groups Div -->


        <!-- Recommended Groups Div -->
        <div class="container" id="recommendedGroupsTab">

            <!-- Div To Display Recommended Groups -->
            <div class="row recommendedGroups">

                    <h4>Recommended Groups</h4>
                    <hr>

                    {% if recommended_groups %}
                        {% for row in recommended_groups %}
                            <div class="row">
                                <ul class="pull-left">
                                    <img class="groupImage" src="{{ url_for('social.static', filename='images/groups.png') }}"
                                         alt="Groups">
                                </ul>
                                <br/>
                                <ul>
                                    <a href="{{ url_for('social.view_group', group_uid=row.group.group_uid) }}">{{ row.group.name }}</a>
                                </ul>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="row">
                            <ul class="pull-left">
                                <img class="sadSmileyImage" src="{{ url_for('social.static', filename='images/sad_smiley.png') }}" alt="Groups">
                            </ul>
                            <br/>
                            <ul>
                                Sorry, We did not find any recommended groups.
                            </ul>
                        </div>
                    {% endif %}

                </div>
            <!-- End of Div To Display Recommended Groups -->

        </div>
        <!-- End of Recommended Groups Div -->

    </div>
    <!-- End of Entire Page Div Container -->

    <br/><br/>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <!-- jQuery Script For DOM Manipulation In Search Groups Page -->
    <script type="text/javascript" src="{{ url_for('social.static', filename='js/groups.js') }}"></script>
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.6.3/js/bootstrap-select.js"></script>

    <script>
        //Script to search for groups while typing a group's name, using autocompletion feature
        $(function () {
            $.ajax({
                url: '{{ url_for("social.get_groups") }}'
            }).done(function (data) {
                $("#autocomplete").autocomplete({
                    minLength: 1,
                    source: data.json_list,
                    focus: function (event, ui) {
                        $("#autocomplete").val(ui.item.label);
                        return false;
                    },
                    select: function (event, ui) {
                        $("#autocomplete").val(ui.item.label);
                        return false;
                    }
                })
                .autocomplete("instance")._renderItem = function (ul, item) {
                    var grp_uid = item.uid;
                    var $a = $("<div></div>");
                    $("<b></b>").text(item.label).appendTo($a).click(function () {
                        window.location = "/social/groups/" + grp_uid;
                    });
                    $("<br>").appendTo($a);
                    $("<span class='m-desc'></span>").text(item.desc).appendTo($a);

                    return $("<li></li>").append($a).appendTo(ul);

                };
            });
        });
    </script>

{% endblock %}